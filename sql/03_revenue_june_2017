SELECT
  'Month' AS time_type,
  FORMAT_DATE('%Y%m', PARSE_DATE('%Y%m%d', date)) AS time,
  trafficSource.source AS source,
  ROUND(SUM(product.productRevenue)/1000000, 4) AS revenue
FROM `bigquery-public-data.google_analytics_sample.ga_sessions_201706*`,
  UNNEST(hits) AS h,
  UNNEST(h.product) AS product
WHERE product.productRevenue IS NOT NULL
GROUP BY time_type, time, source


UNION ALL


SELECT
  'Week' AS time_type,
  FORMAT_DATE('%Y%W', PARSE_DATE('%Y%m%d', date)) AS time,
  trafficSource.source AS source,
  ROUND(SUM(product.productRevenue)/1000000, 4) AS revenue
FROM `bigquery-public-data.google_analytics_sample.ga_sessions_201706*`,
  UNNEST(hits) AS h,
  UNNEST(h.product) AS product
WHERE product.productRevenue IS NOT NULL
GROUP BY time_type, time, source
ORDER BY revenue DESC;
